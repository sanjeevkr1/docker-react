{
  "commands": [
    "#!/bin/bash -xe",
    "set -o pipefail",
    "if command -v docker >/dev/null 2>&1; then",
    "  echo 'Docker is already installed'",
    "  docker version",
    "  exit 0",
    "fi",
    "echo 'Docker not found, installing...'",
    "if [ -f /etc/os-release ]; then . /etc/os-release; fi",
    "if echo \"$NAME\" | grep -qi 'amazon linux'; then",
    "  if command -v amazon-linux-extras >/dev/null 2>&1; then",
    "    echo 'Installing Docker via amazon-linux-extras (AL2)'",
    "    sudo amazon-linux-extras install -y docker",
    "    sudo systemctl enable docker",
    "    sudo systemctl start docker",
    "  else",
    "    echo 'Installing Docker via yum (AL1)'",
    "    sudo yum install -y docker",
    "    sudo chkconfig docker on",
    "    sudo service docker start",
    "  fi",
    "elif command -v yum >/dev/null 2>&1; then",
    "  echo 'Installing Docker via yum'",
    "  sudo yum install -y docker",
    "  sudo systemctl enable docker",
    "  sudo systemctl start docker",
    "elif command -v apt-get >/dev/null 2>&1; then",
    "  echo 'Installing Docker via apt-get'",
    "  sudo apt-get update -y",
    "  sudo apt-get install -y docker.io",
    "  sudo systemctl enable --now docker",
    "else",
    "  echo 'ERROR: Unsupported distro' >&2",
    "  exit 1",
    "fi",
    "sleep 2",
    "sudo docker version",
    "echo 'Docker installation completed successfully'"
  ]
}